<!doctype html>
<html lang="en">
    <head>
        <title>Face tracker</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="./styles/default.css">
    </head>
    <body>
        <div id="content">
            <h2>Example</h2>

            <div id="container" class="relative">
                <video id="videoel" class="display invert" width="600" height="400" preload="auto" loop></video>
                <canvas id="clmtrackerCanvas" class ="display invert absolute" width="600" height="400"></canvas>
                <canvas id="webglCanvas" class ="display absolute" width="600" height="400"></canvas>
            </div>
            <div class="relative">
                <p>Printing coordinates of the first 10 points in facial features:</p>
                <p id="positions"></p>
            </div>
            <select id="filter">
                <option value="occluder">Face Model</option>
                <option value="flowers1">Flower Wreath</option>
            </select>
            <select id="faceContour">
                <option value="1">show face contour</option>
                <option value="0">hide face contour</option>
            </select>
        </div>
        <script id="flowers1VertexShader" type="x-shader/x-vertex">
            uniform mat4 Mproj;
            uniform mat4 Mcam;

            attribute vec2 uv;
            attribute vec3 vert_position;

            varying vec2 geom_texCoord;

            void main() {
                gl_Position = Mproj * Mcam * vec4(vert_position, 1.0);
                geom_texCoord = uv;
            }
        </script>

        <script id="flowers1FragmentShader" type="x-shader/x-fragment">
            precision highp float;

            varying vec2 geom_texCoord;

            uniform sampler2D texture;

            void main() {
                gl_FragColor = texture2D(texture, geom_texCoord);
            }
        </script>

        <script id="occluderVertexShader" type="x-shader/x-vertex">
            uniform mat4 Mproj;
            uniform mat4 Mcam;
            attribute vec3 vert_position;
            attribute vec3 normal; 
            varying vec3 geom_texCoord;

            void main() {
                gl_Position = Mproj * Mcam * vec4(vert_position, 1.0);
                geom_texCoord = normal;
            }
        </script>

        <script id="occluderFragmentShader" type="x-shader/x-fragment">
            precision highp float;
            varying vec3 geom_texCoord;

            void main() {
                gl_FragColor = vec4(geom_texCoord, 1.0);
            }
        </script>
        <script src="./global.js"></script>
        <script src="./js/occluder_mapping.js"></script>
        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <script src="js/gl-matrix-min.js"></script>
        <script src="js/preloadjs-0.6.2.min.js"></script>
        <script src="js/webgl-obj-loader.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.12.2/math.js" type="text/javascript"></script>

        <script src="./js/utils.js"></script>
        <script src="./js/clmtrackr.js"></script>
        <script src="./js/model_pca_20_svm.js"></script>
        <script src="./js/camera_stream.js"></script>
        <script src="./js/helper_information.js"></script>
        <script src="./viewer.js"></script>

        <script>
            var drawFeaturePoints = true;
            var vid = $('#videoel')[0];
            init_camera_stream(vid);

            var ctracker = new clm.tracker();
            ctracker.init(pModel);
            ctracker.start(vid);

            init_helper_information($('#positions')[0]);

            // Draw feature points
            var canvasInput = $('#clmtrackerCanvas')[0];
            var cc = canvasInput.getContext('2d');
            function drawLoop() {
                cc.clearRect(0, 0, canvasInput.width, canvasInput.height);
                if ($("#faceContour").val() == "1"){ctracker.draw(canvasInput);}
                requestAnimationFrame(drawLoop);
            }
            drawLoop();
            initWebGlCanvas();
        </script>
        <script src="./webgl.js"></script>

    </body>
</html>
